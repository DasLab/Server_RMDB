(function(a){a.fn.suit_list_sortable=function(){var f=a(this);if(!f.length){return}var c=f.first().closest("table").hasClass("table-mptt");function d(r,p){var n,l;if(c){function o(s){return parseInt(s.find("th:first").css("padding-left"))}function k(s){var t=o(s);return s.nextUntil(function(){return o(a(this))<=t}).andSelf()}a(".selected").removeClass("selected");var q=o(p);var m=k(p);if(r.data("dir")==="down"){n=m.last().next();if(n.length&&o(n)===q){var j=k(n).last();if(j.length){m.insertAfter(j).addClass("selected")}}}else{l=p.prevUntil(function(){return o(a(this))<=q}).andSelf().first().prev();if(l.length&&o(l)===q){m.insertBefore(l).addClass("selected")}}}else{a(".selected").removeClass("selected");if(r.data("dir")==="down"){n=p.next();if(n.is(":visible")&&n.length){p.insertAfter(n).addClass("selected")}}else{l=p.prev();if(l.is(":visible")&&l.length){p.insertBefore(l).addClass("selected")}}}}function h(l){var k=a(this);var j=k.closest(k.hasClass("sortable-stacked")?"div.inline-related":"tr");d(k,j);l.preventDefault()}function i(m,l,j,k){return a("<a/>").attr("href","#").addClass("sortable sortable-"+l+(k?" sortable-stacked":"")).attr("data-dir",l).html(m).click(j)}f.each(function(){var l=a('<div class="inline-sortable"/>'),n='<i class="icon-arrow-up icon-alpha5"></i>',j=a(this),k=j.hasClass("suit-sortable-stacked");var q=i(n,"up",h,k),p=i(n.replace("-up","-down"),"down",h,k);if(k){var r=j.closest("div.form-row"),o=j.closest("div.inline-related"),m=a("<span/>").attr("class","stacked-inline-sortable");m.append(q).append(p);o.find("h3").append(m);o.append(j);r.remove()}else{j.parent().append(l);l.append(q);l.append(p)}});function g(n,k){if(k.type=="checkbox"){if(k.defaultChecked==k.checked){return false}}else{if(k.type=="select-one"||k.type=="select-multiple"){var m=k.options,o;for(var l=0;l<m.length;l++){o=m[l];if(o.selected&&o.selected==o.defaultSelected){return false}}}else{if(a(k).hasClass("suit-sortable")){if(k.defaultValue==k.value&&k.value==0){return false}}}}return true}if(f&&f.length){var e=f.last();var b=a(this).selector;a(e[0].form).submit(function(l){var j=0,k;a(b).each(function(){var p=a(this);var o=p.attr("name").split(/-\d+-/)[0];var m=p.closest(".dynamic-"+o);var n=m.find(":input[value!=''][type!='hidden']").filter(g);if(!m.length||m.hasClass("has_original")||n.serialize()||n.find(":input[type='file']").addBack().length){k=j++;p.val(k)}})})}Suit.after_inline.register("bind_sortable_arrows",function(j,k){a(k).find(".sortable").click(h)})};a(function(){a(".suit-sortable").suit_list_sortable()})}(Suit.$));