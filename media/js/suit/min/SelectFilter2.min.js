(function(b){function a(c){if(c.tagName.toLowerCase()!="form"){return a(c.parentNode)}return c}window.SelectFilter={init:function(h,c,q,f){if(h.match(/__prefix__/)){return}var d=document.getElementById(h);d.id+="_from";d.className="filtered";var w=d.parentNode.getElementsByTagName("p");for(var y=0;y<w.length;y++){if(w[y].className.indexOf("info")!=-1){d.parentNode.removeChild(w[y])}else{if(w[y].className.indexOf("help")!=-1){d.parentNode.insertBefore(w[y],d.parentNode.firstChild)}}}var o=quickElement("div",d.parentNode);o.className=q?"selector stacked":"selector";var v=quickElement("div",o);v.className="selector-available";var m=quickElement("h2",v,interpolate(gettext("Available %s")+" ",[c]));quickElement("img",m,"","src",f+"img/icon-unknown.gif","width","10","height","10","class","help help-tooltip","title",interpolate(gettext('This is the list of available %s. You may choose some by selecting them in the box below and then clicking the "Choose" arrow between the two boxes.'),[c]));var e=quickElement("p",v,"","id",h+"_filter");e.className="selector-filter";var j=quickElement("label",e,"","for",h+"_input");var B=quickElement("img",j,"","src",f+"img/selector-search.gif","class","help-tooltip","alt","","title",interpolate(gettext("Type into this box to filter down the list of available %s."),[c]));e.appendChild(document.createTextNode(" "));var l=quickElement("input",e,"","type","text","placeholder",gettext("Filter"));l.id=h+"_input";v.appendChild(d);var n=quickElement("a",v,gettext("Choose all"),"title",interpolate(gettext("Click to choose all %s at once."),[c]),"href",'javascript: (function(){ SelectBox.move_all("'+h+'_from", "'+h+'_to"); SelectFilter.refresh_icons("'+h+'");})()',"id",h+"_add_all_link");n.className="selector-chooseall";var p=quickElement("ul",o);p.className="selector-chooser";var u=quickElement("a",quickElement("li",p),gettext("Choose"),"title",gettext("Choose"),"href",'javascript: (function(){ SelectBox.move("'+h+'_from","'+h+'_to"); SelectFilter.refresh_icons("'+h+'");})()',"id",h+"_add_link");u.className="selector-add";var x=quickElement("a",quickElement("li",p),gettext("Remove"),"title",gettext("Remove"),"href",'javascript: (function(){ SelectBox.move("'+h+'_to","'+h+'_from"); SelectFilter.refresh_icons("'+h+'");})()',"id",h+"_remove_link");x.className="selector-remove";var s=quickElement("div",o);s.className="selector-chosen";var g=quickElement("h2",s,interpolate(gettext("Chosen %s")+" ",[c]));quickElement("img",g,"","src",f+"img/icon-unknown.gif","width","10","height","10","class","help help-tooltip","title",interpolate(gettext('This is the list of chosen %s. You may remove some by selecting them in the box below and then clicking the "Remove" arrow between the two boxes.'),[c]));var k=quickElement("select",s,"","id",h+"_to","multiple","multiple","size",d.size,"name",d.getAttribute("name"));k.className="filtered";var A=quickElement("a",s,gettext("Remove all"),"title",interpolate(gettext("Click to remove all chosen %s at once."),[c]),"href",'javascript: (function() { SelectBox.move_all("'+h+'_to", "'+h+'_from"); SelectFilter.refresh_icons("'+h+'");})()',"id",h+"_remove_all_link");A.className="selector-clearall";d.setAttribute("name",d.getAttribute("name")+"_old");addEvent(l,"keypress",function(i){SelectFilter.filter_key_press(i,h)});addEvent(l,"keyup",function(i){SelectFilter.filter_key_up(i,h)});addEvent(l,"keydown",function(i){SelectFilter.filter_key_down(i,h)});addEvent(d,"change",function(i){SelectFilter.refresh_icons(h)});addEvent(k,"change",function(i){SelectFilter.refresh_icons(h)});addEvent(d,"dblclick",function(){SelectBox.move(h+"_from",h+"_to");SelectFilter.refresh_icons(h)});addEvent(k,"dblclick",function(){SelectBox.move(h+"_to",h+"_from");SelectFilter.refresh_icons(h)});addEvent(a(d),"submit",function(){SelectBox.select_all(h+"_to")});SelectBox.init(h+"_from");SelectBox.init(h+"_to");SelectBox.move(h+"_from",h+"_to");if(!q){var r=b(d);var t=b(k);var z=function(){t.height(b(e).outerHeight()+r.outerHeight()+25)};if(r.outerHeight()>0){z()}else{t.closest("fieldset").one("show.fieldset",z)}}SelectFilter.refresh_icons(h)},refresh_icons:function(d){var g=b("#"+d+"_from");var f=b("#"+d+"_to");var e=g.find("option:selected").length>0;var c=f.find("option:selected").length>0;b("#"+d+"_add_link").toggleClass("active",e);b("#"+d+"_remove_link").toggleClass("active",c);b("#"+d+"_add_all_link").toggleClass("active",g.find("option").length>0);b("#"+d+"_remove_all_link").toggleClass("active",f.find("option").length>0)},filter_key_press:function(d,c){var e=document.getElementById(c+"_from");if((d.which&&d.which==13)||(d.keyCode&&d.keyCode==13)){e.selectedIndex=0;SelectBox.move(c+"_from",c+"_to");e.selectedIndex=0;d.preventDefault();return false}},filter_key_up:function(e,d){var f=document.getElementById(d+"_from");var c=f.selectedIndex;SelectBox.filter(d+"_from",document.getElementById(d+"_input").value);f.selectedIndex=c;return true},filter_key_down:function(d,c){var f=document.getElementById(c+"_from");if((d.which&&d.which==39)||(d.keyCode&&d.keyCode==39)){var e=f.selectedIndex;SelectBox.move(c+"_from",c+"_to");f.selectedIndex=(e==f.length)?f.length-1:e;return false}if((d.which&&d.which==40)||(d.keyCode&&d.keyCode==40)){f.selectedIndex=(f.length==f.selectedIndex+1)?0:f.selectedIndex+1}if((d.which&&d.which==38)||(d.keyCode&&d.keyCode==38)){f.selectedIndex=(f.selectedIndex==0)?f.length-1:f.selectedIndex-1}return true}}})(django.jQuery);