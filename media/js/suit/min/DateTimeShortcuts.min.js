var DateTimeShortcuts={calendars:[],calendarInputs:[],clockInputs:[],dismissClockFunc:[],dismissCalendarFunc:[],calendarDivName1:"calendarbox",calendarDivName2:"calendarin",calendarLinkName:"calendarlink",clockDivName:"clockbox",clockLinkName:"clocklink",shortCutsClass:"datetimeshortcuts",timezoneWarningClass:"timezonewarning",timezoneOffset:0,admin_media_prefix:"",init:function(){if(window.__admin_media_prefix__!=undefined){DateTimeShortcuts.admin_media_prefix=window.__admin_media_prefix__}else{DateTimeShortcuts.admin_media_prefix="/missing-admin-media-prefix/"}if(window.__admin_utc_offset__!=undefined){var b=window.__admin_utc_offset__;var d=new Date().getTimezoneOffset()*-60;DateTimeShortcuts.timezoneOffset=d-b}var a=document.getElementsByTagName("input");for(i=0;i<a.length;i++){var c=a[i];if(c.getAttribute("type")=="text"&&c.className.match(/vTimeField/)){DateTimeShortcuts.addClock(c);DateTimeShortcuts.addTimezoneWarning(c)}else{if(c.getAttribute("type")=="text"&&c.className.match(/vDateField/)){DateTimeShortcuts.addCalendar(c);DateTimeShortcuts.addTimezoneWarning(c)}}}},now:function(){if(window.__admin_utc_offset__!=undefined){var a=window.__admin_utc_offset__;var b=new Date();var c=b.getTimezoneOffset()*-60;b.setTime(b.getTime()+1000*(a-c));return b}else{return new Date()}},addTimezoneWarning:function(e){var f=django.jQuery;var b=DateTimeShortcuts.timezoneWarningClass;var d=DateTimeShortcuts.timezoneOffset/3600;if(!d){return}if(f(e).siblings("."+b).length){return}var c;if(d>0){c=ngettext("Note: You are %s hour ahead of server time.","Note: You are %s hours ahead of server time.",d)}else{d*=-1;c=ngettext("Note: You are %s hour behind server time.","Note: You are %s hours behind server time.",d)}c=interpolate(c,[d]);var a=f("<span>");a.attr("class",b);a.text(c);f(e).parent().append(f("<br>")).append(a)},addClock:function(e){var c=DateTimeShortcuts.clockInputs.length;DateTimeShortcuts.clockInputs[c]=e;DateTimeShortcuts.dismissClockFunc[c]=function(){DateTimeShortcuts.dismissClock(c);return true};var a=document.createElement("span");a.className=DateTimeShortcuts.shortCutsClass;e.parentNode.insertBefore(a,e.nextSibling);var d=document.createElement("a");d.setAttribute("href","javascript:DateTimeShortcuts.handleClockQuicklink("+c+", -1);");d.appendChild(document.createTextNode(gettext("Now")));var b=document.createElement("a");b.setAttribute("href","javascript:DateTimeShortcuts.openClock("+c+");");b.id=DateTimeShortcuts.clockLinkName+c;quickElement("img",b,"","src","/site_media/admin/img/icon_clock.gif","alt",gettext("Clock"));a.appendChild(document.createTextNode("\240"));a.appendChild(d);a.appendChild(document.createTextNode("\240|\240"));a.appendChild(b);var h=document.createElement("div");h.style.display="none";h.style.position="absolute";h.className="clockbox module";h.setAttribute("id",DateTimeShortcuts.clockDivName+c);document.body.appendChild(h);addEvent(h,"click",cancelEventPropagation);quickElement("h2",h,gettext("Choose a time"));var f=quickElement("ul",h);f.className="timelist";quickElement("a",quickElement("li",f),gettext("Now"),"href","javascript:DateTimeShortcuts.handleClockQuicklink("+c+", -1);");quickElement("a",quickElement("li",f),gettext("Midnight"),"href","javascript:DateTimeShortcuts.handleClockQuicklink("+c+", 0);");quickElement("a",quickElement("li",f),gettext("6 a.m."),"href","javascript:DateTimeShortcuts.handleClockQuicklink("+c+", 6);");quickElement("a",quickElement("li",f),gettext("Noon"),"href","javascript:DateTimeShortcuts.handleClockQuicklink("+c+", 12);");var g=quickElement("p",h);g.className="calendar-cancel";quickElement("a",g,gettext("Cancel"),"href","javascript:DateTimeShortcuts.dismissClock("+c+");");django.jQuery(document).bind("keyup",function(j){if(j.which==27){DateTimeShortcuts.dismissClock(c);j.preventDefault()}})},openClock:function(b){var c=document.getElementById(DateTimeShortcuts.clockDivName+b);var a=document.getElementById(DateTimeShortcuts.clockLinkName+b);if(getStyle(document.body,"direction")!="rtl"){c.style.left=findPosX(a)+17+"px"}else{c.style.left=findPosX(a)-110+"px"}c.style.top=Math.max(0,findPosY(a)-30)+"px";c.style.display="block";addEvent(document,"click",DateTimeShortcuts.dismissClockFunc[b])},dismissClock:function(a){document.getElementById(DateTimeShortcuts.clockDivName+a).style.display="none";removeEvent(document,"click",DateTimeShortcuts.dismissClockFunc[a])},handleClockQuicklink:function(a,c){var b;if(c==-1){b=DateTimeShortcuts.now()}else{b=new Date(1970,1,1,c,0,0,0)}DateTimeShortcuts.clockInputs[a].value=b.strftime(get_format("TIME_INPUT_FORMATS")[0]);DateTimeShortcuts.clockInputs[a].focus();DateTimeShortcuts.dismissClock(a)},addCalendar:function(g){var d=DateTimeShortcuts.calendars.length;DateTimeShortcuts.calendarInputs[d]=g;DateTimeShortcuts.dismissCalendarFunc[d]=function(){DateTimeShortcuts.dismissCalendar(d);return true};var f=document.createElement("span");f.className=DateTimeShortcuts.shortCutsClass;g.parentNode.insertBefore(f,g.nextSibling);var k=document.createElement("a");k.setAttribute("href","javascript:DateTimeShortcuts.handleCalendarQuickLink("+d+", 0);");k.appendChild(document.createTextNode(gettext("Today")));var b=document.createElement("a");b.setAttribute("href","javascript:DateTimeShortcuts.openCalendar("+d+");");b.id=DateTimeShortcuts.calendarLinkName+d;quickElement("img",b,"","src","/site_media/admin/img/icon_calendar.gif","alt",gettext("Calendar"));f.appendChild(document.createTextNode("\240"));f.appendChild(k);f.appendChild(document.createTextNode("\240|\240"));f.appendChild(b);var j=document.createElement("div");j.style.display="none";j.style.position="absolute";j.className="calendarbox module";j.setAttribute("id",DateTimeShortcuts.calendarDivName1+d);document.body.appendChild(j);addEvent(j,"click",cancelEventPropagation);var c=quickElement("div",j);var h=quickElement("a",c,"<","href","javascript:DateTimeShortcuts.drawPrev("+d+");");h.className="calendarnav-previous";var l=quickElement("a",c,">","href","javascript:DateTimeShortcuts.drawNext("+d+");");l.className="calendarnav-next";var m=quickElement("div",j,"","id",DateTimeShortcuts.calendarDivName2+d);m.className="calendar";DateTimeShortcuts.calendars[d]=new Calendar(DateTimeShortcuts.calendarDivName2+d,DateTimeShortcuts.handleCalendarCallback(d));DateTimeShortcuts.calendars[d].drawCurrent();var e=quickElement("div",j);e.className="calendar-shortcuts";quickElement("a",e,gettext("Yesterday"),"href","javascript:DateTimeShortcuts.handleCalendarQuickLink("+d+", -1);");e.appendChild(document.createTextNode("\240|\240"));quickElement("a",e,gettext("Today"),"href","javascript:DateTimeShortcuts.handleCalendarQuickLink("+d+", 0);");e.appendChild(document.createTextNode("\240|\240"));quickElement("a",e,gettext("Tomorrow"),"href","javascript:DateTimeShortcuts.handleCalendarQuickLink("+d+", +1);");var a=quickElement("p",j);a.className="calendar-cancel";quickElement("a",a,gettext("Cancel"),"href","javascript:DateTimeShortcuts.dismissCalendar("+d+");");django.jQuery(document).bind("keyup",function(n){if(n.which==27){DateTimeShortcuts.dismissCalendar(d);n.preventDefault()}})},openCalendar:function(c){var h=document.getElementById(DateTimeShortcuts.calendarDivName1+c);var a=document.getElementById(DateTimeShortcuts.calendarLinkName+c);var e=DateTimeShortcuts.calendarInputs[c];if(e.value){var g=get_format("DATE_INPUT_FORMATS")[0];var b=e.value.strptime(g);var f=b.getFullYear();var d=b.getMonth()+1;var j=/\d{4}/;if(j.test(f.toString())&&d>=1&&d<=12){DateTimeShortcuts.calendars[c].drawDate(d,f,b)}}if(getStyle(document.body,"direction")!="rtl"){h.style.left=findPosX(a)+17+"px"}else{h.style.left=findPosX(a)-180+"px"}h.style.top=Math.max(0,findPosY(a)-75)+"px";h.style.display="block";addEvent(document,"click",DateTimeShortcuts.dismissCalendarFunc[c])},dismissCalendar:function(a){document.getElementById(DateTimeShortcuts.calendarDivName1+a).style.display="none";removeEvent(document,"click",DateTimeShortcuts.dismissCalendarFunc[a])},drawPrev:function(a){DateTimeShortcuts.calendars[a].drawPreviousMonth()},drawNext:function(a){DateTimeShortcuts.calendars[a].drawNextMonth()},handleCalendarCallback:function(a){var b=get_format("DATE_INPUT_FORMATS")[0];b=b.replace("\\","\\\\");b=b.replace("\r","\\r");b=b.replace("\n","\\n");b=b.replace("\t","\\t");b=b.replace("'","\\'");return["function(y, m, d) { DateTimeShortcuts.calendarInputs[",a,"].value = new Date(y, m-1, d).strftime('",b,"');DateTimeShortcuts.calendarInputs[",a,"].focus();document.getElementById(DateTimeShortcuts.calendarDivName1+",a,").style.display='none';}"].join("")},handleCalendarQuickLink:function(a,c){var b=DateTimeShortcuts.now();b.setDate(b.getDate()+c);DateTimeShortcuts.calendarInputs[a].value=b.strftime(get_format("DATE_INPUT_FORMATS")[0]);DateTimeShortcuts.calendarInputs[a].focus();DateTimeShortcuts.dismissCalendar(a)}};addEvent(window,"load",DateTimeShortcuts.init);